<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, orientation=landscape">
    <title>XUSFUNCHINESE - HSK2 Writing Mode üèÆ</title>
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <style>
        :root { 
            --pinyin-red: #d63031; 
            --paper: rgba(255, 255, 255, 0.95); 
            --gold: #fbc02d; 
            --accent: #218c74; 
            --primary: #01579b;
            --night-sky: radial-gradient(circle at center, #001f3f 0%, #000510 100%);
            --gray: #ccc;
        }
        body { 
            margin: 0; font-family: "Arial Black", sans-serif; 
            background: linear-gradient(135deg, #0277bd 0%, #002f6c 100%); 
            height: 100vh; display: flex; flex-direction: column; overflow: hidden; position: relative;
        }

        /* Cover */
        #cover-page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--night-sky); z-index: 5000; display: flex;
            flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.5s; cursor: pointer;
        }
        .shiny-title {
            font-size: 8vw; font-weight: 900; text-align: center;
            background: linear-gradient(to right, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 10px rgba(255,215,0,0.5));
            animation: shine 3s infinite linear;
        }
        @keyframes shine { 0% { background-position: 0%; } 100% { background-position: 200%; } }

        /* Header */
        header { background: var(--paper); padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 100; }
        .nav-btns button { padding: 8px 15px; margin-right: 5px; border-radius: 20px; border: 2px solid var(--primary); cursor: pointer; font-weight: bold; background: white; color: var(--primary); }
        .active-btn { background: var(--primary) !important; color: white !important; }

        main { flex: 1; display: flex; padding: 20px; gap: 20px; overflow: hidden; }
        #left-panel { 
            flex: 1; background: var(--paper); border-radius: 30px; display: flex; flex-direction: column; 
            align-items: center; justify-content: flex-start; position: relative; border: 5px solid var(--gold);
            padding: 15px 20px 20px 20px; box-sizing: border-box;
        }
        #right-panel { flex: 1; background: var(--paper); border-radius: 30px; padding: 20px; overflow-y: auto; border: 5px solid var(--gold); }

        /* Writing area */
        #writer-container { 
            display: flex; flex-direction: row; justify-content: center; align-items: center;
            gap: 15px; padding: 10px 0; width: 100%; overflow-x: auto; overflow-y: hidden;
            scrollbar-width: none;
        }
        #writer-container::-webkit-scrollbar { display: none; }
        .char-writer { 
            flex: 0 0 240px; width: 240px; height: 240px; background: white; border: 2px solid #ccc; 
            touch-action: none; position: relative; cursor: pointer;
        }
        .char-writer.inactive { opacity: 0.4; filter: grayscale(80%); }
        .char-writer.active { border: 4px solid var(--gold); }
        
        .pinyin { 
            font-size: 32px; color: var(--pinyin-red); font-weight: bold; margin: 0 0 10px 0; 
            text-align: center; max-width: 95%; word-wrap: break-word;
        }
        .meaning { 
            font-size: 20px; color: #555; margin: 0 0 15px 0; text-align: center; 
            max-width: 95%; word-wrap: break-word;
        }

        .list-card { background: white; margin-bottom: 10px; padding: 15px; border-radius: 15px; display: flex; align-items: center; cursor: pointer; border-left: 8px solid var(--primary); transition: 0.2s; }
        .list-card:hover { transform: translateX(10px); background: var(--accent); color: white; }
        .list-char { font-size: 30px; min-width: 80px; text-align: center; }
        
        #hint-area { font-size: 18px; color: var(--primary); margin: 10px 0; font-weight: bold; height: 25px; text-align: center; }
        .watermark { position: fixed; bottom: 10px; right: 20px; color: rgba(255,255,255,0.3); font-style: italic; pointer-events: none; }

        .mode-desc { margin-top: 10px; font-size: 16px; color: #333; text-align: center; max-width: 85%; }

        .button-area {
            margin-top: 20px; display: flex; gap: 12px; flex-wrap: wrap; justify-content: center;
            width: 100%; box-sizing: border-box;
        }
    </style>
</head>
<body>

<div id="cover-page" onclick="enterApp()">
    <div class="shiny-title">HSK 2<br>WRITING MODE</div>
    <p style="color:white; margin-top:20px; letter-spacing:3px;">üèÆ CLICK TO START üèÆ</p>
</div>

<div class="watermark">XUSFUNCHINESE</div>

<header>
    <div class="nav-btns">
        <button id="btn-learn" onclick="switchMode('learn')" class="active-btn">üìñ Learn</button>
        <button id="btn-test" onclick="switchMode('test')">üìù Practice</button>
        <button id="btn-quiz" onclick="switchMode('quiz')">‚ùì Quiz</button>
        <button id="btn-list" onclick="switchMode('list')">üìú List</button>
        <button id="btn-wrong" onclick="switchMode('wrong')">‚ùå Mistakes</button>
    </div>
    <div style="font-weight:bold; color:var(--primary)">HSK2 Writing - <span id="progress">1</span>/150</div>
</header>

<main>
    <div id="left-panel">
        <div id="pinyin-display" class="pinyin"></div>
        <div id="writer-container"></div>
        <div id="meaning-display" class="meaning"></div>
        <div id="hint-area"></div>
        <div class="mode-desc" id="mode-description"></div>
        <div class="button-area">
            <button onclick="prevItem()" style="padding:10px 20px; border-radius:10px;">Previous</button>
            <button onclick="showHint()" id="hint-btn" style="padding:10px 20px; border-radius:10px; background:var(--gold); border:none; font-weight:bold;">Show Hint</button>
            <button onclick="nextItem()" style="padding:10px 20px; border-radius:10px;">Next</button>
        </div>
    </div>

    <div id="right-panel">
        <div id="list-view" style="display:none;"></div>
        <div id="wrong-view" style="display:none;"></div>
        <div id="info-view" style="display:block;">
            <h3 id="info-title">Mode Guide</h3>
            <p id="info-text"></p>
            <div id="stats" style="margin-top:30px; padding:20px; background:var(--accent); color:white; border-radius:20px;">
                Mastery Progress: <span id="stat-done">0</span> / 150
            </div>
        </div>
    </div>
</main>

<script>
const vocabulary = [
    {c:"ÊÇ®", p:"n√≠n", m:"you (polite)"}, {c:"ÂÆÉ", p:"tƒÅ", m:"it"}, {c:"Â§ßÂÆ∂", p:"d√†jiƒÅ", m:"everyone"},
    {c:"ÊØè", p:"mƒõi", m:"every, each"}, {c:"‰∏∫‰ªÄ‰πà", p:"w√®ish√©nme", m:"why"}, {c:"Èõ∂", p:"l√≠ng", m:"zero"},
    {c:"‰∏§", p:"li«éng", m:"two"}, {c:"Áôæ", p:"b«éi", m:"hundred"}, {c:"ÂçÉ", p:"qiƒÅn", m:"thousand"},
    {c:"Á¨¨‰∏Ä", p:"d√¨yƒ´", m:"first"}, {c:"Ê¨°", p:"c√¨", m:"times"}, {c:"‰ª∂", p:"ji√†n", m:"piece"},
    {c:"Âà´", p:"bi√©", m:"do not"}, {c:"ÈùûÂ∏∏", p:"fƒìich√°ng", m:"very"}, {c:"‰πü", p:"yƒõ", m:"also"},
    {c:"Ëøò", p:"h√°i", m:"still"}, {c:"ÊúÄ", p:"zu√¨", m:"the most"}, {c:"Áúü", p:"zhƒìn", m:"really"},
    {c:"Ê≠£Âú®", p:"zh√®ngz√†i", m:"be being"}, {c:"Â∑≤Áªè", p:"y«êjƒ´ng", m:"already"}, {c:"‰∏ÄËµ∑", p:"y√¨q«ê", m:"together"},
    {c:"ÂÜç", p:"z√†i", m:"again"}, {c:"Â∞±", p:"ji√π", m:"at once, then"}, {c:"Âõ†‰∏∫", p:"yƒ´nw√®i", m:"because"},
    {c:"ÊâÄ‰ª•", p:"su«íy«ê", m:"so"}, {c:"ËôΩÁÑ∂", p:"suƒ´r√°n", m:"although"}, {c:"‰ΩÜÊòØ", p:"d√†nsh√¨", m:"but"},
    {c:"‰ªé", p:"c√≥ng", m:"from"}, {c:"ÊØî", p:"b«ê", m:"comparing to"}, {c:"ÂæÄ", p:"w«éng", m:"toward, to"},
    {c:"Á¶ª", p:"l√≠", m:"distance from"}, {c:"Âæó", p:"de", m:"structural particle"}, {c:"ÁùÄ", p:"zhe", m:"aspect particle"},
    {c:"Ëøá", p:"gu√≤", m:"experienced particle"}, {c:"Âêß", p:"ba", m:"suggestion particle"}, {c:"Êú∫Âú∫", p:"jƒ´ch«éng", m:"airport"},
    {c:"ÊïôÂÆ§", p:"ji√†osh√¨", m:"classroom"}, {c:"ÊàøÈó¥", p:"f√°ngjiƒÅn", m:"room"}, {c:"Ë∑Ø", p:"l√π", m:"road"},
    {c:"Â∑¶Ëæπ", p:"zu«íbiƒÅn", m:"left side"}, {c:"Âè≥Ëæπ", p:"y√≤ubiƒÅn", m:"right side"}, {c:"Â§ñ", p:"w√†i", m:"outside"},
    {c:"ÊóÅËæπ", p:"p√°ngbiƒÅn", m:"side"}, {c:"‰∏Ä‰∏ã", p:"y√≠xi√†", m:"a short while"}, {c:"Êó©‰∏ä", p:"z«éoshang", m:"morning"},
    {c:"Êôö‰∏ä", p:"w«énshang", m:"night"}, {c:"Â∞èÊó∂", p:"xi«éosh√≠", m:"hour"}, {c:"Êó∂Èó¥", p:"sh√≠jiƒÅn", m:"time"},
    {c:"ÂéªÂπ¥", p:"q√πni√°n", m:"last year"}, {c:"Êó•", p:"r√¨", m:"date, day"}, {c:"ÁîüÊó•", p:"shƒìngr√¨", m:"birthday"},
    {c:"Âì•Âì•", p:"gƒìge", m:"older brother"}, {c:"ÂßêÂßê", p:"jiƒõjie", m:"older sister"}, {c:"ÂºüÂºü", p:"d√¨di", m:"younger brother"},
    {c:"Â¶πÂ¶π", p:"m√®imei", m:"younger sister"}, {c:"‰∏àÂ§´", p:"zh√†ngfu", m:"husband"}, {c:"Â¶ªÂ≠ê", p:"qƒ´zi", m:"wife"},
    {c:"Â≠©Â≠ê", p:"h√°izi", m:"child"}, {c:"Áî∑‰∫∫", p:"n√°nr√©n", m:"man"}, {c:"Â•≥‰∫∫", p:"n«ör√©n", m:"woman"},
    {c:"ÊúçÂä°Âëò", p:"f√∫w√πyu√°n", m:"waiter"}, {c:"È±º", p:"y√∫", m:"fish"}, {c:"ÁæäËÇâ", p:"y√°ngr√≤u", m:"mutton"},
    {c:"ÁâõÂ•∂", p:"ni√∫n«éi", m:"milk"}, {c:"È∏°Ëõã", p:"jƒ´d√†n", m:"egg"}, {c:"Ë•øÁìú", p:"xƒ´guƒÅ", m:"watermelon"},
    {c:"ÂíñÂï°", p:"kƒÅfƒìi", m:"coffee"}, {c:"Èõ™", p:"xuƒõ", m:"snow"}, {c:"ËçØ", p:"y√†o", m:"medicine"},
    {c:"ÊâãÊú∫", p:"sh«íujƒ´", m:"cellphone"}, {c:"ÊâãË°®", p:"sh«íubi«éo", m:"watch"}, {c:"ÁúºÁùõ", p:"y«énjing", m:"eye"},
    {c:"Ë∫´‰Ωì", p:"shƒìnt«ê", m:"body"}, {c:"ÂÖ¨ÂÖ±Ê±ΩËΩ¶", p:"g≈çngg√≤ngq√¨chƒì", m:"bus"}, {c:"Êä•Á∫∏", p:"b√†ozh«ê", m:"newspaper"},
    {c:"Èó®", p:"m√©n", m:"door"}, {c:"È¢ò", p:"t√≠", m:"topic, item"}, {c:"ËØæ", p:"k√®", m:"lesson"},
    {c:"Âßì", p:"x√¨ng", m:"surname"}, {c:"ÈóÆÈ¢ò", p:"w√®nt√≠", m:"question"}, {c:"‰∫ãÊÉÖ", p:"sh√¨qing", m:"matter"},
    {c:"ËÄÉËØï", p:"k«éosh√¨", m:"exam"}, {c:"Á•®", p:"pi√†o", m:"ticket"}, {c:"ÊÑèÊÄù", p:"y√¨si", m:"meaning"},
    {c:"È¢úËâ≤", p:"y√°ns√®", m:"color"}, {c:"ÈìÖÁ¨î", p:"qiƒÅnb«ê", m:"pencil"}, {c:"Èù¢Êù°", p:"mi√†nti√°o", m:"noodle"},
    {c:"ÁÅ´ËΩ¶Á´ô", p:"hu«íchƒìzh√†n", m:"train station"}, {c:"ÂÖ¨Âè∏", p:"g≈çngsƒ´", m:"company"}, {c:"ÂÆæÈ¶Ü", p:"bƒ´nggu«én", m:"hotel"},
    {c:"ËØ¥ËØù", p:"shu≈çhu√†", m:"talk"}, {c:"Âçñ", p:"m√†i", m:"sell"}, {c:"ÈóÆ", p:"w√®n", m:"ask"},
    {c:"Ëµ∞", p:"z«íu", m:"walk"}, {c:"Ëøõ", p:"j√¨n", m:"enter"}, {c:"Âá∫", p:"ch≈´", m:"come out"},
    {c:"Ë∑ëÊ≠•", p:"p«éob√π", m:"run"}, {c:"Âà∞", p:"d√†o", m:"arrive"}, {c:"Á©ø", p:"chuƒÅn", m:"wear"},
    {c:"Ê¥ó", p:"x«ê", m:"wash"}, {c:"Áªô", p:"gƒõi", m:"give"}, {c:"Êâæ", p:"zh«éo", m:"find, look for"},
    {c:"ÊáÇ", p:"d«íng", m:"understand"}, {c:"Á¨ë", p:"xi√†o", m:"smile, laugh"}, {c:"ÂëäËØâ", p:"g√†osu", m:"tell"},
    {c:"ÂáÜÂ§á", p:"zh«înb√®i", m:"prepare"}, {c:"ÂºÄÂßã", p:"kƒÅish«ê", m:"begin"}, {c:"‰ªãÁªç", p:"ji√®sh√†o", m:"introduce"},
    {c:"Â∏ÆÂä©", p:"bƒÅngzh√π", m:"help"}, {c:"Áé©", p:"w√°n", m:"play"}, {c:"ÈÄÅ", p:"s√≤ng", m:"present, deliver"},
    {c:"Á≠â", p:"dƒõng", m:"wait"}, {c:"ËÆ©", p:"r√†ng", m:"let, allow"}, {c:"Ëµ∑Â∫ä", p:"q«êchu√°ng", m:"get up"},
    {c:"Âî±Ê≠å", p:"ch√†nggƒì", m:"sing"}, {c:"Ë∑≥Ëàû", p:"ti√†ow«î", m:"dance"}, {c:"ÊóÖÊ∏∏", p:"l«öy√≥u", m:"travel"},
    {c:"‰∏äÁè≠", p:"sh√†ngbƒÅn", m:"go to work"}, {c:"ÁîüÁóÖ", p:"shƒìngb√¨ng", m:"get sick"}, {c:"‰ºëÊÅØ", p:"xi≈´xi", m:"rest"},
    {c:"ËøêÂä®", p:"y√πnd√≤ng", m:"exercise"}, {c:"Ê∏∏Ê≥≥", p:"y√≥uy«íng", m:"swim"}, {c:"Ë∏¢Ë∂≥ÁêÉ", p:"tƒ´z√∫qi√∫", m:"play football"},
    {c:"ÊâìÁØÆÁêÉ", p:"d«él√°nqi√∫", m:"play basketball"}, {c:"ÂÆå", p:"w√°n", m:"finish"}, {c:"ËßâÂæó", p:"ju√©de", m:"think, feel"},
    {c:"Áü•ÈÅì", p:"zhƒ´d√†o", m:"know"}, {c:"Â∏åÊúõ", p:"xƒ´w√†ng", m:"hope"}, {c:"ÂèØ‰ª•", p:"kƒõy«ê", m:"can, may"},
    {c:"Ë¶Å", p:"y√†o", m:"want"}, {c:"ÂèØËÉΩ", p:"kƒõn√©ng", m:"may, possible"}, {c:"È´ò", p:"gƒÅo", m:"tall, high"},
    {c:"Á∫¢", p:"h√≥ng", m:"red"}, {c:"ÁôΩ", p:"b√°i", m:"white"}, {c:"Èªë", p:"hƒìi", m:"black"},
    {c:"Âøô", p:"m√°ng", m:"busy"}, {c:"Âø´", p:"ku√†i", m:"fast"}, {c:"ÊÖ¢", p:"m√†n", m:"slow"},
    {c:"Ëøú", p:"yu«én", m:"far"}, {c:"Ëøë", p:"j√¨n", m:"close, near"}, {c:"Â•ΩÂêÉ", p:"h«éochƒ´", m:"delicious"},
    {c:"Á¥Ø", p:"l√®i", m:"tired"}, {c:"Èïø", p:"ch√°ng", m:"long"}, {c:"Êñ∞", p:"xƒ´n", m:"new"},
    {c:"Ë¥µ", p:"gu√¨", m:"expensive"}, {c:"‰æøÂÆú", p:"pi√°nyi", m:"cheap"}, {c:"Êô¥", p:"q√≠ng", m:"sunny, fine"},
    {c:"Èò¥", p:"yƒ´n", m:"cloudy"}, {c:"Èîô", p:"cu√≤", m:"wrong"}, {c:"Âø´‰πê", p:"ku√†il√®", m:"happy"},
    {c:"ÂØπ", p:"du√¨", m:"right, correct"}
];

let currentIndex = 0;
let currentMode = 'learn';
let writers = [];
let divs = [];
let wrongAnswers = [];
let hintShown = false;

const encouragements = ["Â§™Ê£í‰∫ÜÔºÅ", "ÈùûÂ∏∏Â•ΩÔºÅ", "ÂÜôÂæóÁúüÊ£íÔºÅ", "ÁªßÁª≠Âä†Ê≤πÔºÅ", "ÂÆåÁæéÔºÅ", "‰∫Ü‰∏çËµ∑ÔºÅ", "ÁúüËÅ™ÊòéÔºÅ", "‰ºòÁßÄÔºÅ", "Ê£íÊûÅ‰∫ÜÔºÅ", "Â§™ÂéâÂÆ≥‰∫ÜÔºÅ"];

const modeDescriptions = {
    learn: "Watch stroke order and listen to pronunciation. üìñ",
    test: "Write from memory with outline. Correct strokes move forward. üìù",
    quiz: "Pure challenge: No outline at first. Click 'Show Hint' if stuck. ‚ùì"
};

function initWriters(chars, mode) {
    writers = [];
    divs = [];
    document.getElementById('writer-container').innerHTML = '';
    hintShown = false;

    const commonOptions = {
        width: 240, height: 240, padding: 5,
        strokeColor: '#01579b', drawingColor: '#d63031',
        drawingWidth: (mode === 'test' || mode === 'quiz') ? 28 : 18,
        outlineColor: '#ddd', radicalColor: '#1666c4'
    };

    const charArray = chars.split('');

    charArray.forEach((char, index) => {
        const div = document.createElement('div');
        div.className = 'char-writer';
        div.dataset.index = index;
        div.onclick = () => replaySingleChar(index);
        document.getElementById('writer-container').appendChild(div);
        divs.push(div);

        const options = {...commonOptions};
        if (mode === 'learn') { options.showCharacter = true; options.showOutline = true; div.classList.add('inactive'); }
        else if (mode === 'test') { options.showCharacter = false; options.showOutline = true; }
        else if (mode === 'quiz') { options.showCharacter = false; options.showOutline = false; }

        const writer = HanziWriter.create(div, char, options);
        writers.push(writer);

        if (mode === 'learn') {
            if (index === 0) setTimeout(() => startSequentialAnimation(0), 600);
        } else {
            let completed = 0;
            writer.quiz({
                onComplete: () => {
                    completed++;
                    if (completed === writers.length) {
                        const msg = encouragements[Math.floor(Math.random() * encouragements.length)];
                        document.getElementById('hint-area').innerText = msg + " üåü";
                        speak(msg);
                        setTimeout(nextItem, 2000);
                    }
                },
                onMistake: () => {
                    const currentObj = vocabulary[currentIndex];
                    if (!wrongAnswers.includes(currentObj)) wrongAnswers.push(currentObj);
                    document.getElementById('hint-area').innerText = "Try again~ ‚úçÔ∏è";
                    updateStats();
                }
            });
        }
    });
    if (mode === 'learn') speak(vocabulary[currentIndex].c);
}

function startSequentialAnimation(index) {
    if (index >= writers.length) { divs.forEach(d => d.classList.remove('inactive', 'active')); return; }
    divs[index].classList.remove('inactive');
    divs[index].classList.add('active');
    writers[index].animateCharacter(() => {
        divs[index].classList.remove('active');
        startSequentialAnimation(index + 1);
    });
}

function replaySingleChar(clickedIndex) {
    if (currentMode !== 'learn') return;
    divs.forEach((d, i) => {
        if (i === clickedIndex) { d.classList.remove('inactive'); d.classList.add('active'); }
        else { d.classList.add('inactive'); d.classList.remove('active'); }
    });
    writers[clickedIndex].animateCharacter(() => {
        divs.forEach((d, i) => { d.classList.remove('active'); if (i > clickedIndex) d.classList.add('inactive'); });
    });
}

function render() {
    const item = vocabulary[currentIndex];
    document.getElementById('progress').innerText = currentIndex + 1;
    document.getElementById('pinyin-display').innerText = item.p;
    document.getElementById('meaning-display').innerText = item.m;
    document.getElementById('hint-area').innerText = "";
    document.getElementById('mode-description').innerText = modeDescriptions[currentMode];
    initWriters(item.c, currentMode);
}

function switchMode(m, specificIndex = null) {
    currentMode = m;
    if (specificIndex !== null) currentIndex = specificIndex;
    document.querySelectorAll('.nav-btns button').forEach(b => b.classList.remove('active-btn'));
    document.getElementById('btn-' + m).classList.add('active-btn');
    document.getElementById('list-view').style.display = (m === 'list') ? 'block' : 'none';
    document.getElementById('wrong-view').style.display = (m === 'wrong') ? 'block' : 'none';
    document.getElementById('info-view').style.display = (['learn', 'test', 'quiz'].includes(m)) ? 'block' : 'none';
    if (m === 'list') renderList();
    if (m === 'wrong') renderWrong();
    if (['learn', 'test', 'quiz'].includes(m)) render();
}

function showHint() {
    if (currentMode === 'quiz' && writers.length > 0 && !hintShown) {
        writers.forEach(w => w.showOutline());
        hintShown = true;
        document.getElementById('hint-area').innerText = "Outline shown üí°";
    } else if (currentMode === 'learn') startSequentialAnimation(0);
}

function nextItem() { if (currentIndex < vocabulary.length - 1) { currentIndex++; render(); } else { alert("HSK 2 Complete! üéâ"); } }
function prevItem() { if (currentIndex > 0) { currentIndex--; render(); } }

function renderList() {
    const container = document.getElementById('list-view');
    container.innerHTML = "<h3>HSK 2 Word List</h3>" + vocabulary.map((v, i) => `
        <div class="list-card" onclick="switchMode('learn', ${i})">
            <span class="list-char">${v.c}</span>
            <div style="margin-left:20px;"><span style="color:var(--pinyin-red); font-weight:bold;">${v.p}</span><br><small>${v.m}</small></div>
        </div>`).join('');
}

function renderWrong() {
    const container = document.getElementById('wrong-view');
    if (!wrongAnswers.length) { container.innerHTML = "<p style='text-align:center;'>No mistakes! Excellent! üèÜ</p>"; return; }
    container.innerHTML = "<h3>Review Mistakes</h3>" + wrongAnswers.map(v => {
        const idx = vocabulary.findIndex(it => it.c === v.c);
        return `<div class="list-card" onclick="switchMode('quiz', ${idx})"><span class="list-char"><b>${v.c}</b></span><div style="margin-left:15px;"><span style="color:var(--pinyin-red); font-weight:bold;">${v.p}</span><br><small>${v.m}</small></div></div>`;
    }).join('');
}

function speak(t) { 
    if ('speechSynthesis' in window) {
        window.speechSynthesis.cancel();
        const utter = new SpeechSynthesisUtterance(t); 
        utter.lang = 'zh-CN'; utter.rate = 0.8; 
        window.speechSynthesis.speak(utter); 
    }
}

function updateStats() { document.getElementById('stat-done').innerText = vocabulary.length - wrongAnswers.length; }

function enterApp() { 
    document.getElementById('cover-page').style.opacity = '0'; 
    setTimeout(() => { document.getElementById('cover-page').style.display = 'none'; switchMode('learn'); }, 500); 
}

window.addEventListener('resize', () => { if (writers.length > 0) render(); });
</script>
</body>
</html>